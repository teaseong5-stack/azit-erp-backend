<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>아지트 ERP - 예약 관리</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 사이드바 메뉴 -->
    <nav class="sidebar">
        <div class="sidebar-header"><h3><i class="bi bi-house-heart-fill me-2"></i>아지트 ERP</h3></div>
        <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link" href="dashboard.html"><i class="bi bi-grid-fill me-2"></i>대시보드</a></li>
            <li class="nav-item"><a class="nav-link" href="customers.html"><i class="bi bi-people-fill me-2"></i>고객 관리</a></li>
            <li class="nav-item"><a class="nav-link active" href="reservations.html"><i class="bi bi-calendar-check-fill me-2"></i>예약 관리</a></li>
			<li class="nav-item"><a class="nav-link" href="bulk_upload.html"><i class="bi bi-upload"></i> 일괄 등록</a></li>
            <li class="nav-item"><a class="nav-link" href="reports.html"><i class="bi bi-file-earmark-bar-graph-fill me-2"></i>리포트</a></li>
            <li class="nav-item"><a class="nav-link" href="partners.html"><i class="bi bi-building me-2"></i>제휴업체 관리</a></li>
            <li class="nav-item"><a class="nav-link" href="accounting.html"><i class="bi bi-calculator-fill me-2"></i>회계 관리</a></li>
        </ul>
        <ul id="admin-menu" class="nav flex-column mt-auto">
            <li class="nav-item"><a class="nav-link" href="https://azit-erp-backend-1.onrender.com/admin/" target="_blank">...</a></li>
        </ul>
    </nav>

    <!-- 메인 콘텐츠 -->
    <main class="content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>예약 관리</h1>
            <button id="logout-button" class="btn btn-outline-danger">로그아웃</button>
        </div>
        
        <div class="card">
            <div class="card-body">
                <h2 class="card-title">새 예약 등록</h2>
                <form id="reservation-form" class="mb-3">
                    <div class="border p-3 rounded mb-3">
                        <div class="row">
                            <div class="col-md-4"><label for="res-category" class="form-label fw-bold">1. 카테고리</label>
                                <select id="res-category" class="form-select" required>
                                    <option value="TOUR">투어</option>
                                    <option value="RENTAL_CAR">렌터카</option>
                                    <option value="ACCOMMODATION">숙박</option>
                                    <option value="GOLF">골프</option>
                                    <option value="TICKET">티켓</option>
                                    <option value="OTHER">기타</option>
                                </select>
                            </div>
                            <div class="col-md-4"><label for="res-manager" class="form-label fw-bold">2. 담당자</label><select id="res-manager" class="form-select" required></select></div>
                            <div class="col-md-4"><label for="res-reservation-date" class="form-label fw-bold">3. 예약일</label><input type="date" class="form-control" id="res-reservation-date"></div>
                        </div>
                    </div>
                    <div id="dynamic-form-fields" class="border p-3 rounded mb-3"></div>
                    <div class="border p-3 rounded">
                        <label class="form-label fw-bold">공통 정보</label>
                        <div class="row g-3 mt-1">
                            <div class="col-md-12"><label for="res-customer" class="form-label">고객 선택</label><input class="form-control" list="customerOptions" id="res-customer" placeholder="고객명 검색 또는 선택..." required><datalist id="customerOptions"></datalist><span id="returning-customer-alert" class="form-text text-success fw-bold"></span></div>
                            <div class="col-md-4"><label for="res-price" class="form-label">총 판매가</label><input type="number" class="form-control" id="res-price" value="0" required></div>
                            <div class="col-md-4"><label for="res-cost" class="form-label">총 원가</label><input type="number" class="form-control" id="res-cost" value="0" required></div>
                            <div class="col-md-4"><label for="res-payment-amount" class="form-label">결제 금액</label><input type="number" class="form-control" id="res-payment-amount" value="0" required></div>
                            <div class="col-md-4"><label for="res-status" class="form-label">예약 상태</label>
                                <select id="res-status" class="form-select" required>
                                    <option value="PENDING">상담중</option>
                                    <option value="CONFIRMED">예약확정</option>
                                    <option value="PAID">잔금완료</option>
                                    <option value="COMPLETED">여행완료</option>
                                    <option value="CANCELED">취소</option>
                                </select>
                            </div>
                            <div class="col-md-4"><label for="res-payment-status" class="form-label">결제 현황</label><select id="res-payment-status" class="form-select"><option value="UNPAID">미결제</option><option value="DEPOSIT">예약금 입금</option><option value="PAID">결제완료</option></select></div>
                            <div class="col-md-4"><label for="res-special-notes" class="form-label">특이사항</label><input type="text" class="form-control" id="res-special-notes"></div>
                            <div class="col-md-6"><label for="res-requests" class="form-label">요청사항 (고객용)</label><textarea class="form-control" id="res-requests" rows="3"></textarea></div>
                            <div class="col-md-6"><label for="res-notes" class="form-label">내부 메모 (직원용)</label><textarea class="form-control" id="res-notes" rows="3"></textarea></div>
                        </div>
                    </div>
                    <div class="col-12"><button type="submit" class="btn btn-success w-100 mt-3">예약 추가</button></div>
                </form>
                <hr>
                <h3 class="mt-4">예약 목록</h3>
                <div id="filter-form" class="row g-3 align-items-center mb-3 p-3 bg-light rounded">
                    <div class="col-md-3"><label for="filter-category" class="form-label">카테고리</label><select id="filter-category" class="form-select"><option value="">전체</option><option value="TOUR">투어</option><option value="RENTAL_CAR">렌터카</option><option value="ACCOMMODATION">숙박</option><option value="GOLF">골프</option><option value="TICKET">티켓</option><option value="OTHER">기타</option></select></div>
                    <div class="col-md-3"><label for="filter-search" class="form-label">상품/고객명</label><input type="text" id="filter-search" class="form-control" placeholder="검색..."></div>
                    <div class="col-md-4"><label class="form-label">시작일</label><div class="input-group"><input type="date" id="filter-start-date" class="form-control"><span class="input-group-text">~</span><input type="date" id="filter-end-date" class="form-control"></div></div>
                    <div class="col-md-2 align-self-end"><div class="d-grid gap-2 d-md-flex"><button id="filter-button" class="btn btn-primary w-100">조회</button><button id="filter-reset-button" class="btn btn-secondary w-100">초기화</button></div></div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead><tr><th>ID</th><th>예약일</th><th>상태</th><th>결제</th><th>카테고리</th><th>상품명</th><th>고객명</th><th>출발일</th><th>결제금액</th><th>관리</th></tr></thead>
                        <tbody id="reservation-list-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- 모달 창들 -->
    <div class="modal fade" id="statusEditModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">예약 상태 변경</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p><strong id="status-modal-tour-name"></strong> 예약 건의 상태를 변경합니다.</p><select id="status-modal-select" class="form-select"><option value="PENDING">상담중</option><option value="CONFIRMED">예약확정</option><option value="PAID">잔금완료</option><option value="COMPLETED">여행완료</option><option value="CANCELED">취소</option></select></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button><button type="button" class="btn btn-primary" id="status-modal-save-button">변경사항 저장</button></div></div></div></div>
    <div class="modal fade" id="detailEditModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">예약 상세 수정</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="detail-edit-form">
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit-customer" class="form-label">고객</label>
                                <input class="form-control" list="editCustomerOptions" id="edit-customer" placeholder="고객명 검색 또는 선택..." required>
                                <datalist id="editCustomerOptions"></datalist>
                            </div>
                            <div class="col-md-6">
                                <label for="edit-category-select" class="form-label">카테고리</label>
                                <select id="edit-category-select" class="form-select" required>
                                    <option value="TOUR">투어</option>
                                    <option value="RENTAL_CAR">렌터카</option>
                                    <option value="ACCOMMODATION">숙박</option>
                                    <option value="GOLF">골프</option>
                                    <option value="TICKET">티켓</option>
                                    <option value="OTHER">기타</option>
                                </select>
                            </div>
                        </div>
                        <div id="edit-dynamic-form-fields" class="mb-3"></div>
                        <div class="row g-3">
                            <div class="col-md-6"><label for="edit-price" class="form-label">판매가</label><input type="number" class="form-control" id="edit-price" required></div>
                            <div class="col-md-6"><label for="edit-cost" class="form-label">원가</label><input type="number" class="form-control" id="edit-cost" required></div>
                            <div class="col-md-6"><label for="edit-payment-amount" class="form-label">결제 금액</label><input type="number" class="form-control" id="edit-payment-amount"></div>
                            <div class="col-md-6"><label for="edit-payment-status" class="form-label">결제 현황</label>
                                <select id="edit-payment-status" class="form-select">
                                    <option value="UNPAID">미결제</option>
                                    <option value="DEPOSIT">예약금 입금</option>
                                    <option value="PAID">결제완료</option>
                                </select>
                            </div>
                            <div class="col-md-6"><label for="edit-requests" class="form-label">요청사항</label><textarea class="form-control" id="edit-requests" rows="3"></textarea></div>
                            <div class="col-md-6"><label for="edit-notes" class="form-label">내부 메모</label><textarea class="form-control" id="edit-notes" rows="3"></textarea></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button><button type="button" class="btn btn-primary" id="detail-modal-save-button">변경사항 저장</button></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="common.js" defer></script>
    <script src="reservations.js" defer></script>
</body>
</html>
